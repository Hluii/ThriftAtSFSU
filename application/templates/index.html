<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Thrift at SFSU</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <!-- Add noUiSlider CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">
</head>

<body>

  <!-- ========== Top Navbar with Search and Auth ========== -->
  <nav class="navbar">
    <div class="navbar-left">
      <a href="{{ url_for('home') }}" class="logo">
        <span class="logoPurple">Thrift</span><span class="logoYellow">@SFSU</span>
      </a>
    </div>

    <form action="{{ url_for('home') }}" method="get" class="search-form">
      <label for="category" class="visually-hidden">Category</label>
      <select name="category">
        <option value="">All</option>
        {% for cat in categories %}
        <option value="{{ cat }}" {% if cat==category %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>

      <label for="keyword" class="visually-hidden">Keyword</label>
      <input type="text" name="keyword" placeholder="Search products..." value="{{ keyword }}">

      <button type="submit" aria-label="Search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </form>

    <div class="auth-buttons">
      <a href="{{ url_for('login') }}" class="btn btn-outline">Login</a>
    </div>
  </nav>

  <!-- ========== Submenu for About the Team ========== -->
  <nav class="submenu">
    <ul>
      <!-- Filter Toggle Button -->
      <li>
        <!-- Updated button structure for text + animated icon -->
        <button id="toggleFiltersBtn" class="toggle-filters-btn">
          <span class="button-text">Filters</span>
          <span class="icon-container">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </span>
        </button>
      </li>
      
      <!-- About the Team Dropdown -->
      <li class="dropdown">
        <a href="#">About the Team â–¾</a>
        <ul class="dropdown-menu">
          <li><a href="{{ url_for('joe') }}">Joseph Shur</a></li>
          <li><a href="{{ url_for('sid') }}">Sid Padmanabhuni</a></li>
          <li><a href="{{ url_for('hilary') }}">Hilary Lui</a></li>
          <li><a href="{{ url_for('annison') }}">Annison Van</a></li>
          <li><a href="{{ url_for('joseph') }}">Joseph Alhambra</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- ========== Main Container ========== -->
  <section style="display: flex; justify-content: center;">
  <div class="containerGrid">

    <!-- Hamburger button to toggle filters -->
    <!-- MOVED TO SUBMENU -->
    <!-- <button id="toggleFiltersBtn" class="toggle-filters-btn">â˜°</button> -->

    <!-- ===== Filter Container =====-->
    <div class="containerFixed" id="filtersContainer">
      <div class="filters">
        <h2>Filters</h2>

        <p>Price Range</p>
        <!-- Add slider container and value displays -->
        <div class="price-slider-container">
          <div id="price-slider"></div>
          <div class="price-slider-values">
            $<span id="slider-price-min">0</span> - $<span id="slider-price-max">2000</span>
          </div>
        </div>
    
        <div class="condition">
          <label>Condition</label>
          <div class="radio-buttons">
            <label class="conditionButton"><input type="radio" name="condition" value="very-worn"> Very Worn</label>
            <label class="conditionButton"><input type="radio" name="condition" value="used"> Used</label>
            <label class="conditionButton"><input type="radio" name="condition" value="fairly-used"> Fairly Used</label>
            <label class="conditionButton"><input type="radio" name="condition" value="good-condition"> Good Condition</label>
            <label class="conditionButton"><input type="radio" name="condition" value="great-condition"> Great Condition</label>
          </div>
        </div>
    
        <div class="seller-rating">
          <p style="padding-top: 13px;">Seller Rating:</p>
          <div class="stars">
            <span class="star" data-value="1">&#10029;</span>
            <span class="star" data-value="2">&#10029;</span>
            <span class="star" data-value="3">&#10029;</span>
            <span class="star" data-value="4">&#10029;</span>
            <span class="star" data-value="5">&#10029;</span>
          </div>
        </div>
      </div>
      

      <div class="posted-since">
        <label id="selectedDateDisplay" for="postedDate">Posted Since:</label>
        <div class="calendar-wrapper">
          <button type="button" class="calendar-button" onclick="document.getElementById('postedDate').showPicker()">ðŸ“… Pick a Date</button>
          <input type="date" id="postedDate" class="hidden-date" onchange="document.getElementById('selectedDateDisplay').textContent = 'Posted Since: ' + this.value;">

        </div>
      </div>

      <button class="apply-button">Apply</button>

      <!--script for clicking the star rating & selecting date-->
      <script>
        const stars = document.querySelectorAll('.star');
        stars.forEach(star => {
          star.addEventListener('click', function () {
            const value = this.getAttribute('data-value');
          
            stars.forEach(s => {
              if (s.getAttribute('data-value') <= value) {
                s.classList.add('filled');
              } else {
                s.classList.remove('filled');
              }
            });
          });
        });
      </script>
    </div>

    

    <!-- =====Search Results Container=====-->
    <div class="container">
      <!-- ========== Show Search Criteria / Results Info ========== -->
      <div class="search-info">
        <p>Showing <strong>{{ count }}</strong> result{{ 's' if count != 1 else '' }}
          {% if category or keyword %}
          for
          {% if category %} Category: <strong>{{ category }}</strong>{% endif %}
          {% if keyword %} Keyword: <strong>{{ keyword }}</strong>{% endif %}
          {% else %}
          (All Products)
          {% endif %}
        </p>
      </div>

      <!-- ========== Product Listing ========== -->
      <div class="product-list">
        {% for item in items %}
        <div class="card product-card">
          <h3 class="product-title">{{ item.title }} â€” ${{ item.price }}</h3>
          <p class="product-description">{{ item.description }}</p>
          {% if item.has_image %}
          <img src="{{ url_for('serve_image', product_id=item.product_id) }}" alt="Product image" class="product-image">
          {% else %}
          <p><em>No image available</em></p>
          {% endif %}
        </div>
        {% else %}
        <p>No items found matching your search.</p>
        {% endfor %}
      </div>
    </div>
  </div>
  </section>

  <!-- Script to toggle filters visibility -->
  <script>
    const toggleBtn = document.getElementById('toggleFiltersBtn');
    const filtersContainer = document.getElementById('filtersContainer');

    toggleBtn.addEventListener('click', () => {
      filtersContainer.classList.toggle('collapsed');
      toggleBtn.classList.toggle('active'); 
    });

    // Optional: Hide button on larger screens using JS, 
    // but CSS media queries are generally preferred for this.
    // function checkScreenSize() {
    //   if (window.innerWidth > 768) { // Example breakpoint
    //     toggleBtn.style.display = 'none';
    //     filtersContainer.classList.remove('collapsed'); // Ensure filters are shown
    //   } else {
    //     toggleBtn.style.display = 'block';
    //     // Optional: Default to collapsed on small screens
    //     // if (!filtersContainer.classList.contains('user-toggled')) {
    //     //   filtersContainer.classList.add('collapsed');
    //     // }
    //   }
    // }
    // window.addEventListener('resize', checkScreenSize);
    // checkScreenSize(); // Initial check

    // Add a class to track if the user explicitly toggled
    // toggleBtn.addEventListener('click', () => {
    //   filtersContainer.classList.toggle('collapsed');
    //   filtersContainer.classList.add('user-toggled'); 
    // });

  </script>
  <!-- Add noUiSlider JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
  <!-- Script to initialize the slider -->
  <script>
    const priceSlider = document.getElementById('price-slider');
    const minPriceDisplay = document.getElementById('slider-price-min');
    const maxPriceDisplay = document.getElementById('slider-price-max');

    noUiSlider.create(priceSlider, {
        start: [0, 2000], // Initial min and max values
        connect: true,    // Connect the handles with a colored bar
        range: {
            'min': 0,
            'max': 2000 // Adjust max as needed
        },
        step: 10, // Price steps
        format: { // Format numbers as integers
          to: function (value) {
            return Math.round(value);
          },
          from: function (value) {
            return Number(value);
          }
        }
    });

    // Update display values when slider changes
    priceSlider.noUiSlider.on('update', function (values, handle) {
        minPriceDisplay.textContent = values[0];
        maxPriceDisplay.textContent = values[1];
        // TODO: Potentially update hidden input fields here if needed for form submission
    });
  </script>
</body>

</html>